# IPv6 configuration - enables IPv6 on all interfaces
net.ipv6.conf.all.disable_ipv6=0        # Enable IPv6 on all network interfaces
net.ipv6.conf.default.disable_ipv6=0    # Enable IPv6 by default on new interfaces
net.ipv6.conf.lo.disable_ipv6=0         # Enable IPv6 on loopback interface

# Network queue and congestion control
net.core.default_qdisc=fq               # Use Fair Queuing as default packet scheduler
net.ipv4.tcp_congestion_control=bbr     # Use BBR congestion control algorithm for better throughput

# CPU scheduler tuning
kernel.sched_migration_cost_ns=5000000  # Increase cost of CPU migration (5ms) to reduce unnecessary migrations
kernel.sched_autogroup_enabled=0        # Disable automatic process grouping for more predictable scheduling

# File descriptor limits for Kubernetes
fs.file-max = 2097152
fs.nr_open = 1048576
fs.inotify.max_user_watches = 524288
fs.inotify.max_user_instances = 512

# Network optimizations for Kubernetes
net.core.somaxconn = 32768
net.core.netdev_max_backlog = 16384
net.core.rmem_default = 262144
net.core.rmem_max = 16777216
net.core.wmem_default = 262144
net.core.wmem_max = 16777216

# TCP settings for high connection loads
net.ipv4.tcp_max_syn_backlog = 8192
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_keepalive_time = 600
net.ipv4.tcp_keepalive_probes = 3
net.ipv4.tcp_keepalive_intvl = 90
net.ipv4.tcp_max_tw_buckets = 2000000
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_rmem = 4096 87380 16777216
net.ipv4.tcp_wmem = 4096 16384 16777216

# Connection tracking for iptables/netfilter (used by kube-proxy)
net.netfilter.nf_conntrack_max = 1048576
net.netfilter.nf_conntrack_tcp_timeout_established = 86400

# Process limits
kernel.pid_max = 4194304
kernel.threads-max = 1048576

# Memory management
vm.max_map_count = 262144